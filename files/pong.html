<html><head>
		<title>pong.js</title>
		<style>
			canvas { width: 98%; height: 98% }
			body { background-color: #000;}
		</style>
	<style id="esmst">.ab_tnav_wrp{padding-left:112px}#esp_logo{width:112px}#hdtb_msb,#hdtb-mn-gp{padding-left:96px}.klcar,#lxhdr{margin-left:120px}#rcnt,.ucm{margin-left:112px}</style></head>
	<body>
		<script src="http://threejs.org/build/three.min.js"></script> <!-- THREE.js -->
		<script src="http://learningthreejs.com/data/THREEx/THREEx.KeyboardState.js"></script> <!-- THREE.js keyboard -->
		<script src="http://192.168.0.3:1234/socket.io/socket.io.js"></script> <!-- Socket.io -->
		<script>




			var initializing = THREE.Scene(); // empty scene

			var scene = new THREE.Scene();
			var camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);

			var renderer = new THREE.WebGLRenderer();
			renderer.setSize(window.innerWidth - 10, window.innerHeight - 10);
			document.body.appendChild(renderer.domElement);

			var paddleGeometry = new THREE.CubeGeometry(0.5,2,0.5);
			var ballGeometry = new THREE.SphereGeometry(0.4, 0.4, 0.4);
			var ceilFloorGeometry = new THREE.CubeGeometry(20, 3.5, 2);

			var leftMaterial = new THREE.MeshBasicMaterial({color: 0xffff00});
			var rightMaterial = new THREE.MeshBasicMaterial({color: 0x00ffff});
			var ballMaterial = new THREE.MeshBasicMaterial({color: 0xff0000});
			var ceilFloorMaterial = new THREE.MeshBasicMaterial({color: 0xffffff})

			var leftPaddle = new THREE.Mesh(paddleGeometry, leftMaterial);
			scene.add(leftPaddle);

			var rightPaddle = new THREE.Mesh(paddleGeometry, rightMaterial);
			scene.add(rightPaddle);

			var ball = new THREE.Mesh(ballGeometry, ballMaterial);
			scene.add(ball);

			var ceiling = new THREE.Mesh(ceilFloorGeometry, ceilFloorMaterial);
			scene.add(ceiling);

			var floor = new THREE.Mesh(ceilFloorGeometry, ceilFloorMaterial);
			scene.add(floor);

     		var ambientLight = new THREE.AmbientLight(0x00ff00); // add lighting
     		scene.add(ambientLight);


			ceiling.position.y = -5;
			floor.position.y = 5;

			leftPaddle.position = {"x": -5, "y": 0, "z": 0};
			rightPaddle.position = {"x": 5, "y": 0, "z": 0};

			var keyboard = new THREEx.KeyboardState();
			var moveCount = 0;
			var keyPress = false;

			camera.position.z = 5;



			var ballX = 0;
			var ballY = 0;

			var gameId = -1;
			var game;
			var player = 0;
			var myPaddle;

			var ready = false;


			var socket = io.connect('http://192.168.0.3:1234/');

			function startGame(){
				ballX = -0.03;
				ballY = 0.01;
			}


  			socket.on('ballPacket', function (ballData){
  					ball.position.x = ballData.x;
  					ball.position.y = ballData.y;
  					ballX = ballData.i;
  					ballY = ballData.j;
  					//socket.emit('paddlePacket', )
  			})

  			socket.on('init', function (gameData){
  				gameId = gameData.id;
  				game = gameData.game;
  				player = gameData.player
  				console.log(gameData);
  				if (player == 1){
  					myPaddle = leftPaddle;
  				} else {
  					myPaddle = rightPaddle;
  					ready = true;
  				}
  			})

  			socket.on('player2Join', function (update){
  				if (update.id == gameId){
  					game = update.game;
  					console.log(game);
  					ready = true;
  				}
  			})

			// THREE event loop
			var render = function () {
				requestAnimationFrame(render);

				ball.rotation.y += 0.1;
				ball.position.x += ballX;
				ball.position.y += ballY;



				// check for collisions
				// the ball will potentially colide if it's X coord is
				// +-5 - paddle width - ball width (+-5 - 0.25 - 0.2)
				if (ball.position.x >= 4.55){
					// potential collision with right paddle
					// abs(ball.y - right.y) needs to be less than 1
					if (Math.abs(ball.position.y - rightPaddle.position.y) <= 1){
						ballX *= -1
					}
				} else if (ball.position.x <= -4.55){
					// potential collision with left paddle
					// abs(ball.y - left.y) needs to be less than 1
					if (Math.abs(ball.position.y - leftPaddle.position.y) <= 1){
						ballX *= -1
					}
				}
				// lower than floor : ballY >= (5 - half ball height - half the cieling/floor height)
				if (ball.position.y <= (5 - 0.2 - 1.75)){


					ballY *= -1
				}if (ball.position.y >= -(5 - 0.2 - 1.75)){
					ballY *= -1
				}

				// handle keybaord events
				if (keyboard.pressed("up")){
					if ((myPaddle.position.y <= 2.25)){
						myPaddle.position.y+=0.1;
					}
				}
				if (keyboard.pressed("down")){
					if ((myPaddle.position.y >= -2.25)){
						myPaddle.position.y-=0.1;
					}
				}

				moveCount++;


				if (gameId != -1){
					renderer.render(scene, camera);
				} // else show some sort of loading screen
			};

			render();






		</script>
	

</body></html>

<!--davetest-->